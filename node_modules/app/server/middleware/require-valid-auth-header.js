module.exports = function require_valid_auth_header( req, res, next ){
  
  if( !req.headers.authorization ) return res.status( 400 ).send( 'Authorization Header Missing' );

  var jwt = req.headers.authorization.split( 'Bearer ', 2 )[ 1 ];

  if( !jwt ) return res.status( 400 ).send( 'Malformed Authorization Header - Format is "Bearer token"' );

  var jwt_content = require('jwt-simple').decode( jwt, process.env.JWT_USER_TOKEN_SECRET );

  if( !jwt_content.oauth_token || !jwt_content.oauth_token_secret ) return res.status( 400 ).send( 'Invalid Authorization Token' );

  req.auth = jwt_content;

  next();
}