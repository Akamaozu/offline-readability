var favorites_api_routes = module.exports = require('express').Router();

favorites_api_routes.use( require('app/server/middleware/require-valid-auth-header') );

favorites_api_routes.get('/:page?', function( req, res ){
  
  var readability = require('app/server/modules/readability'),
      params = {};

  params.favorite = 1;
  params.page = parseInt( req.params.page ) || 1;
  params.per_page = req.params.per_page < 50 ? parseInt( req.params.per_page ) : 20;
  params.order = ( req.params.order === 'chron' ? 'date_added' : '-date_added' );

  readability.bookmarks( req.auth.oauth_token, req.auth.oauth_token_secret, params, function( error, favorites ){

    if( error ) return res.status( 400 ).send( error.toString() );

    res.json( favorites );
  });
});