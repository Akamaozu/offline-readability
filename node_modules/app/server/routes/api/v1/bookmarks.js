var bookmark_api_routes = module.exports = require('express').Router();

bookmark_api_routes.use( require('app/server/middleware/require-valid-auth-header') );

bookmark_api_routes.get('/:page?', function( req, res ){
  
  var readability = require('app/server/modules/readability'),
      params = {};

  params.page = parseInt( req.query.page ) || 1;
  params.per_page = req.query.per_page < 50 ? parseInt( req.query.per_page ) : 20;
  params.order = ( req.query.order === 'chron' ? 'date_added' : '-date_added' );

  readability.bookmarks( req.auth.oauth_token, req.auth.oauth_token_secret, params, function( error, bookmarks ){

    if( error ) return res.status( 400 ).send( error.toString() );

    res.json( bookmarks );
  });
});