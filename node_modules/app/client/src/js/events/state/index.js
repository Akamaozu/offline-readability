var app_state = {};

module.exports = function( noticeboard ){

  noticeboard.watch('get-app-state', 'state-getter', function( msg ){

    var state_processor = msg.notice;

    state_processor( JSON.parse( JSON.stringify( app_state ) ) );
  });

  noticeboard.watch('update-app-state', 'app-state-updater', function( msg ){

    var update = msg.notice,
        is_updated = false;

    for( var key in update ){

      if( !update.hasOwnProperty( key ) ) continue;

      if( app_state[ key ] === update[ key ] ) continue;

      app_state[ key ] = update[ key ];

      is_updated = true;
    }

    if( !is_updated ) return;

    noticeboard.notify( 'app-state-updated', app_state, 'app-state-updater' );
  });
}